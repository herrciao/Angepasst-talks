---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import PostCard from '@/components/PostCard.astro';
import Pagination from '@/components/Pagination.astro';
import { SITE } from '@/config';

export async function getStaticPaths() {
  const allPosts = await getCollection('posts', ({ data }) => !data.draft);
  const sorted = allPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
  const totalPages = Math.ceil(sorted.length / SITE.postsPerPage);

  return Array.from({ length: totalPages - 1 }, (_, i) => ({
    params: { page: String(i + 2) },
    props: { allPosts: sorted, totalPages, currentPage: i + 2 },
  }));
}

const { allPosts, totalPages, currentPage } = Astro.props;
const posts = allPosts.slice((currentPage - 1) * SITE.postsPerPage, currentPage * SITE.postsPerPage);
---

<BaseLayout title={`第 ${currentPage} 頁`}>
  <div class="space-y-4">
    {posts.map((post) => <PostCard post={post} />)}
  </div>
  <Pagination currentPage={currentPage} totalPages={totalPages} baseUrl="/" />
</BaseLayout>
